apiVersion: v1
kind: Template
metadata:
  name: rmo-config-template

parameters:
- name: REGION
  required: true
  description: "AWS region for the RHOBS cell (e.g., us-west-2, us-east-1)"
- name: SECTORS
  required: true
  description: "Comma-separated list of sectors this config applies to"
- name: SUFFIX
  required: true
  description: "Unique suffix for the SelectorSyncSet name (e.g., integration-us-west-2-main)"
- name: PROBE_API_URL
  required: true
  description: "RHOBS Probe API URL for synthetic monitoring"
- name: OIDC_CLIENT_ID
  required: true
  description: "OIDC Client ID for RHOBS authentication"
- name: OIDC_CLIENT_SECRET
  required: true
  description: "OIDC Client Secret for RHOBS authentication"
- name: OIDC_ISSUER_URL
  required: true
  description: "OIDC Issuer URL for RHOBS authentication"
- name: DYNATRACE_ENABLED
  value: "false"
  description: "Enable Dynatrace synthetic monitoring (true/false)"

objects:
- apiVersion: hive.openshift.io/v1
  kind: SelectorSyncSet
  metadata:
    name: route-monitor-operator-config-${SUFFIX}
    labels:
      managed.openshift.io/gitRepoName: app-interface
      managed.openshift.io/osd: 'true'
  spec:
    clusterDeploymentSelector:
      matchLabels:
        api.openshift.com/managed: 'true'
      matchExpressions:
      - key: api.openshift.com/sector
        operator: In
        values:
${{SECTORS}}
    resourceApplyMode: Sync
    resources:
    - apiVersion: v1
      kind: ConfigMap
      metadata:
        name: route-monitor-operator-config
        namespace: openshift-route-monitor-operator
        annotations:
          qontract.ignore_reconcile_time: "true"
      data:
        PROBE_API_URL: ${PROBE_API_URL}
        DYNATRACE_ENABLED: ${DYNATRACE_ENABLED}
    - apiVersion: v1
      kind: Secret
      metadata:
        name: route-monitor-operator-rhobs-credentials
        namespace: openshift-route-monitor-operator
        annotations:
          qontract.ignore_reconcile_time: "true"
      type: Opaque
      stringData:
        OIDC_CLIENT_ID: ${OIDC_CLIENT_ID}
        OIDC_CLIENT_SECRET: ${OIDC_CLIENT_SECRET}
        OIDC_ISSUER_URL: ${OIDC_ISSUER_URL}
